import{$a as C,Aa as m,Cb as T,Eb as O,Hb as V,Jb as F,Kb as N,La as d,Lb as H,Ma as o,Na as a,Nb as j,Pa as _,Qa as f,Ra as p,V as h,Va as S,W as g,Wa as c,Xa as u,Za as b,_a as E,ab as P,na as r,ra as v,rb as y,sb as I,tb as M,xa as x,zb as w}from"./chunk-4U6L5S5K.js";function D(n,t){if(n&1&&(o(0,"option",10),c(1),a()),n&2){let e=t.$implicit;d("value",e.id),r(),u(e.nombre)}}function $(n,t){if(n&1&&(o(0,"option",10),c(1),a()),n&2){let e=t.$implicit;d("value",e.id),r(),u(e.nombres)}}function L(n,t){if(n&1){let e=_();o(0,"div",2)(1,"label",3),c(2,"M\xE9dico"),a(),o(3,"select",4),f("change",function(s){h(e);let l=p();return g(l.onMedicoChange(s))}),o(4,"option",5),c(5,"-- Seleccione --"),a(),m(6,$,2,2,"option",6),a()()}if(n&2){let e=p();r(6),d("ngForOf",e.medicos)}}function W(n,t){if(n&1&&(o(0,"option",10),c(1),a()),n&2){let e=t.$implicit;d("value",e.fecha+" "+e.hora),r(),b("",e.fecha," - ",e.hora)}}function A(n,t){if(n&1){let e=_();o(0,"div",2)(1,"label",3),c(2,"Horario disponible"),a(),o(3,"select",11),P("ngModelChange",function(s){h(e);let l=p();return C(l.horarioSeleccionado,s)||(l.horarioSeleccionado=s),g(s)}),o(4,"option",5),c(5,"-- Seleccione --"),a(),m(6,W,2,3,"option",6),a()()}if(n&2){let e=p();r(3),E("ngModel",e.horarioSeleccionado),r(3),d("ngForOf",e.horarios)}}function B(n,t){if(n&1){let e=_();o(0,"button",12),f("click",function(){h(e);let s=p();return g(s.reservarCita())}),c(1,"Reservar"),a()}}var k=class n{constructor(t){this.http=t}especialidades=[];medicos=[];horarios=[];especialidadSeleccionada="";medicoSeleccionado="";horarioSeleccionado="";mensaje="";exito=!1;ngOnInit(){this.cargarEspecialidades()}cargarEspecialidades(){this.http.get("/api/especialidades/").subscribe({next:t=>this.especialidades=t,error:t=>console.error("Error cargando especialidades:",t)})}onEspecialidadChange(t){let e=t.target.value;this.especialidadSeleccionada=e,this.medicoSeleccionado="",this.horarios=[],this.medicos=[],e&&this.http.get(`/api/medicos/?especialidad=${e}`).subscribe({next:i=>this.medicos=i,error:i=>console.error("Error cargando m\xE9dicos:",i)})}onMedicoChange(t){let e=t.target.value;this.medicoSeleccionado=e,this.horarioSeleccionado="",this.horarios=[],e&&this.http.get(`/api/horarios/?medico=${e}`).subscribe({next:i=>this.horarios=i,error:i=>console.error("Error cargando horarios:",i)})}reservarCita(){if(!this.medicoSeleccionado||!this.horarioSeleccionado){this.mensaje="Debe seleccionar m\xE9dico y horario.",this.exito=!1;return}let[t,e]=this.horarioSeleccionado.split(" "),i={medico:this.medicoSeleccionado,fecha:t,hora:e},s=localStorage.getItem("token")||"";this.http.post("/api/citas/reservar/",i,{headers:{Authorization:`Bearer ${s}`}}).subscribe({next:l=>{this.mensaje=l.message||"Cita reservada con \xE9xito.",this.exito=!0},error:l=>{console.error("Error reservar cita:",l),this.mensaje=l?.error?.error||"Error al reservar la cita.",this.exito=!1}})}static \u0275fac=function(e){return new(e||n)(v(w))};static \u0275cmp=x({type:n,selectors:[["app-panel-paciente"]],decls:15,vars:9,consts:[[1,"container","mt-4"],[1,"text-primary"],[1,"mb-3"],[1,"form-label"],[1,"form-select",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],["class","btn btn-success",3,"click",4,"ngIf"],[1,"mt-3"],[3,"value"],[1,"form-select",3,"ngModelChange","ngModel"],[1,"btn","btn-success",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"h2",1),c(2,"Reservar Cita"),a(),o(3,"div",2)(4,"label",3),c(5,"Especialidad"),a(),o(6,"select",4),f("change",function(l){return i.onEspecialidadChange(l)}),o(7,"option",5),c(8,"-- Seleccione --"),a(),m(9,D,2,2,"option",6),a()(),m(10,L,7,1,"div",7)(11,A,7,2,"div",7)(12,B,2,0,"button",8),o(13,"p",9),c(14),a()()),e&2&&(r(9),d("ngForOf",i.especialidades),r(),d("ngIf",i.medicos.length>0),r(),d("ngIf",i.horarios.length>0),r(),d("ngIf",i.horarios.length>0),r(),S("text-success",i.exito)("text-danger",!i.exito),r(),u(i.mensaje))},dependencies:[M,y,I,j,N,H,F,O,V,T],encapsulation:2})};export{k as PanelPaciente};
