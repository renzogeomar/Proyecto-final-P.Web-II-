import{a as X}from"./chunk-QIA3ECHZ.js";import{a as K,b as Q}from"./chunk-YMMBAANU.js";import{a as D,b as N,c as O,d as q,e as z,f as B,g as L,h as $,i as U,j as G,k as R,l as J}from"./chunk-D74MC6KC.js";import{Bb as I,Cb as k,Da as h,Db as T,Eb as j,Kb as F,Mb as W,N as w,Oa as m,Pa as t,Qa as r,R as C,Ra as V,Sa as S,Ta as H,Ua as M,Va as p,Wa as l,X as _,Y as u,a as y,ab as a,bb as g,cb as v,fb as f,gb as b,hb as x,pa as c,ta as E,za as P}from"./chunk-MSDOTIZ4.js";var A=class o{constructor(i,e){this.http=i;this.auth=e}baseUrl="/api/admin";authHeaders(){let i=this.auth.obtenerToken()||"";return new F({Authorization:`Bearer ${i}`})}listar(i){return this.http.get(`${this.baseUrl}/medicos/${i}/horarios/`,{headers:this.authHeaders()})}crear(i,e){return this.http.post(`${this.baseUrl}/medicos/${i}/horarios/`,e,{headers:this.authHeaders()})}actualizar(i,e){return this.http.put(`${this.baseUrl}/horarios/${i}/`,e,{headers:this.authHeaders()})}eliminar(i){return this.http.delete(`${this.baseUrl}/horarios/${i}/`,{headers:this.authHeaders()})}static \u0275fac=function(e){return new(e||o)(C(W),C(K))};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};function ie(o,i){if(o&1&&(t(0,"div",6),a(1),r()),o&2){let e=l();c(),g(e.mensaje)}}function te(o,i){o&1&&(t(0,"div"),a(1,"Cargando m\xE9dicos..."),r())}function re(o,i){o&1&&(t(0,"div",16),a(1," No se encontraron m\xE9dicos. "),r())}function ne(o,i){if(o&1){let e=M();t(0,"tr")(1,"td"),a(2),r(),t(3,"td"),a(4),r(),t(5,"td"),a(6),r(),t(7,"td")(8,"button",21),p("click",function(){let n=_(e).$implicit,d=l(3);return u(d.editarMedico(n))}),a(9,"Editar"),r(),t(10,"button",22),p("click",function(){let n=_(e).$implicit,d=l(3);return u(d.eliminarMedico(n))}),a(11,"Eliminar"),r(),t(12,"button",23),p("click",function(){let n=_(e).$implicit,d=l(3);return u(d.verHorarios(n))}),a(13,"Horarios"),r()()()}if(o&2){let e=i.$implicit,s=l(3);c(2),g(e.nombres),c(2),g(e.correo),c(2),g(s.nombreDeEspecialidad(e.especialidad))}}function oe(o,i){if(o&1&&(t(0,"div",17)(1,"table",18)(2,"thead")(3,"tr")(4,"th"),a(5,"Nombre"),r(),t(6,"th"),a(7,"Correo"),r(),t(8,"th"),a(9,"Especialidad"),r(),t(10,"th",19),a(11,"Acciones"),r()()(),t(12,"tbody"),h(13,ne,14,3,"tr",20),r()()()),o&2){let e=l(2);c(13),m("ngForOf",e.medicos)}}function ae(o,i){if(o&1){let e=M();S(0),t(1,"div",7)(2,"div",8)(3,"div",9)(4,"input",10),x("ngModelChange",function(n){_(e);let d=l();return b(d.busqueda,n)||(d.busqueda=n),u(n)}),p("keyup.enter",function(){_(e);let n=l();return u(n.buscar())}),r(),t(5,"button",11),p("click",function(){_(e);let n=l();return u(n.buscar())}),a(6,"Buscar"),r()()(),t(7,"div",12)(8,"button",13),p("click",function(){_(e);let n=l();return u(n.nuevoMedico())}),a(9,"A\xF1adir M\xE9dico"),r()()(),h(10,te,2,0,"div",5)(11,re,2,0,"div",14)(12,oe,14,1,"div",15),H()}if(o&2){let e=l();c(4),f("ngModel",e.busqueda),c(6),m("ngIf",e.cargando),c(),m("ngIf",!e.cargando&&e.medicos.length===0),c(),m("ngIf",!e.cargando&&e.medicos.length>0)}}function ce(o,i){o&1&&(t(0,"h4"),a(1,"A\xF1adir M\xE9dico"),r())}function de(o,i){o&1&&(t(0,"h4"),a(1,"Editar M\xE9dico"),r())}function se(o,i){if(o&1&&(t(0,"option",34),a(1),r()),o&2){let e=i.$implicit;m("ngValue",e.id),c(),g(e.nombre)}}function le(o,i){if(o&1){let e=M();S(0),h(1,ce,2,0,"h4",5)(2,de,2,0,"h4",5),t(3,"form",24,0),p("ngSubmit",function(){_(e);let n=l();return u(n.guardarMedico())}),t(5,"div",25)(6,"label",26),a(7,"Nombres"),r(),t(8,"input",27),x("ngModelChange",function(n){_(e);let d=l();return b(d.formMedico.nombres,n)||(d.formMedico.nombres=n),u(n)}),r()(),t(9,"div",25)(10,"label",26),a(11,"Correo"),r(),t(12,"input",28),x("ngModelChange",function(n){_(e);let d=l();return b(d.formMedico.correo,n)||(d.formMedico.correo=n),u(n)}),r()(),t(13,"div",25)(14,"label",26),a(15,"Especialidad"),r(),t(16,"select",29),x("ngModelChange",function(n){_(e);let d=l();return b(d.formMedico.especialidad,n)||(d.formMedico.especialidad=n),u(n)}),t(17,"option",30),a(18,"--Seleccione--"),r(),h(19,se,2,2,"option",31),r()(),t(20,"button",32),a(21),r(),t(22,"button",33),p("click",function(){_(e);let n=l();return u(n.cancelarMedico())}),a(23,"Cancelar"),r()(),H()}if(o&2){let e=l();c(),m("ngIf",e.modo==="crear"),c(),m("ngIf",e.modo==="editar"),c(6),f("ngModel",e.formMedico.nombres),c(4),f("ngModel",e.formMedico.correo),c(4),f("ngModel",e.formMedico.especialidad),c(),m("ngValue",null),c(2),m("ngForOf",e.especialidades),c(2),v(" ",e.modo==="crear"?"Crear M\xE9dico":"Guardar Cambios"," ")}}function me(o,i){o&1&&(t(0,"div"),a(1,"Cargando horarios..."),r())}function _e(o,i){o&1&&(t(0,"div",16),a(1," No hay horarios registrados para este m\xE9dico. "),r())}function ue(o,i){if(o&1){let e=M();t(0,"tr")(1,"td"),a(2),r(),t(3,"td"),a(4),r(),t(5,"td")(6,"span",53),a(7),r()(),t(8,"td")(9,"button",21),p("click",function(){let n=_(e).$implicit,d=l(3);return u(d.editarHorario(n))}),a(10,"Editar"),r(),t(11,"button",54),p("click",function(){let n=_(e).$implicit,d=l(3);return u(d.eliminarHorario(n))}),a(12,"Eliminar"),r()()()}if(o&2){let e=i.$implicit;c(2),g(e.fecha),c(2),g(e.hora),c(2),m("ngClass",e.disponible?"bg-success":"bg-secondary"),c(),v(" ",e.disponible?"S\xED":"No"," ")}}function pe(o,i){if(o&1&&(t(0,"div",17)(1,"table",50)(2,"thead",51)(3,"tr")(4,"th"),a(5,"Fecha"),r(),t(6,"th"),a(7,"Hora"),r(),t(8,"th"),a(9,"Disponible"),r(),t(10,"th",52),a(11,"Acciones"),r()()(),t(12,"tbody"),h(13,ue,13,4,"tr",20),r()()()),o&2){let e=l(2);c(13),m("ngForOf",e.horarios)}}function he(o,i){o&1&&(t(0,"h5"),a(1,"A\xF1adir Horario"),r())}function ge(o,i){o&1&&(t(0,"h5"),a(1,"Editar Horario"),r())}function fe(o,i){if(o&1){let e=M();t(0,"button",33),p("click",function(){_(e);let n=l(2);return u(n.cancelarHorario())}),a(1," Cancelar "),r()}}function be(o,i){if(o&1){let e=M();S(0),t(1,"div",35)(2,"h4"),a(3," Horarios de: "),t(4,"span",36),a(5),r(),t(6,"small",37),a(7),r()(),t(8,"button",38),p("click",function(){_(e);let n=l();return u(n.volverAListaMedicos())}),a(9," \u2190 Volver a m\xE9dicos "),r()(),h(10,me,2,0,"div",5)(11,_e,2,0,"div",14)(12,pe,14,1,"div",15),V(13,"hr",39),h(14,he,2,0,"h5",5)(15,ge,2,0,"h5",5),t(16,"form",40,1),p("ngSubmit",function(){_(e);let n=l();return u(n.guardarHorario())}),t(18,"div",41)(19,"label",26),a(20,"Fecha"),r(),t(21,"input",42),x("ngModelChange",function(n){_(e);let d=l();return b(d.formHorario.fecha,n)||(d.formHorario.fecha=n),u(n)}),r()(),t(22,"div",41)(23,"label",26),a(24,"Hora"),r(),t(25,"input",43),x("ngModelChange",function(n){_(e);let d=l();return b(d.formHorario.hora,n)||(d.formHorario.hora=n),u(n)}),r()(),t(26,"div",44)(27,"div",45)(28,"input",46),x("ngModelChange",function(n){_(e);let d=l();return b(d.formHorario.disponible,n)||(d.formHorario.disponible=n),u(n)}),r(),t(29,"label",47),a(30,"Disponible"),r()()(),t(31,"div",48)(32,"button",32),a(33),r(),h(34,fe,2,0,"button",49),r()(),H()}if(o&2){let e=l();c(5),g(e.medicoActual==null?null:e.medicoActual.nombres),c(2),v("(",e.nombreDeEspecialidad((e.medicoActual==null?null:e.medicoActual.especialidad)||0),")"),c(3),m("ngIf",e.cargandoHorarios),c(),m("ngIf",!e.cargandoHorarios&&e.horarios.length===0),c(),m("ngIf",!e.cargandoHorarios&&e.horarios.length>0),c(2),m("ngIf",e.modoHorario==="crear"),c(),m("ngIf",e.modoHorario==="editar"),c(6),f("ngModel",e.formHorario.fecha),c(4),f("ngModel",e.formHorario.hora),c(3),f("ngModel",e.formHorario.disponible),c(5),v(" ",e.modoHorario==="crear"?"Crear Horario":"Guardar Cambios"," "),c(),m("ngIf",e.modoHorario==="editar")}}var Y=class o{constructor(i,e,s){this.svc=i;this.espSvc=e;this.horSvc=s}medicos=[];especialidades=[];cargando=!0;mensaje="";busqueda="";vista="lista";modo="crear";formMedico=this.formMedicoPorDefecto();medicoActual=null;horarios=[];cargandoHorarios=!1;modoHorario="crear";formHorario=this.formHorarioPorDefecto();ngOnInit(){this.cargarEspecialidades(),this.cargarMedicos()}formMedicoPorDefecto(){return{id:null,nombres:"",correo:"",especialidad:null}}cargarEspecialidades(){this.espSvc.listar().subscribe({next:i=>this.especialidades=i,error:i=>console.error("Error cargando especialidades",i)})}cargarMedicos(){this.cargando=!0,this.svc.listar(this.busqueda).subscribe({next:i=>{this.medicos=i,this.cargando=!1},error:i=>{console.error("Error cargando m\xE9dicos:",i),this.mensaje="Error cargando m\xE9dicos",this.cargando=!1}})}nombreDeEspecialidad(i){let e=this.especialidades.find(s=>s.id===i);return e?e.nombre:`#${i}`}buscar(){this.cargarMedicos()}nuevoMedico(){this.modo="crear",this.formMedico=this.formMedicoPorDefecto(),this.vista="formMedico"}editarMedico(i){this.modo="editar",this.formMedico=y({},i),this.vista="formMedico"}cancelarMedico(){this.vista="lista",this.formMedico=this.formMedicoPorDefecto(),this.modo="crear"}guardarMedico(){this.modo==="crear"?this.svc.crear(this.formMedico).subscribe({next:()=>{this.mensaje="M\xE9dico creado.",this.cancelarMedico(),this.cargarMedicos()},error:i=>{console.error("Error creando m\xE9dico:",i),this.mensaje="Error creando m\xE9dico."}}):this.svc.actualizar(this.formMedico.id,this.formMedico).subscribe({next:()=>{this.mensaje="M\xE9dico actualizado.",this.cancelarMedico(),this.cargarMedicos()},error:i=>{console.error("Error actualizando m\xE9dico:",i),this.mensaje="Error actualizando m\xE9dico."}})}eliminarMedico(i){confirm(`\xBFEliminar al m\xE9dico "${i.nombres}"?`)&&this.svc.eliminar(i.id).subscribe({next:()=>{this.mensaje="M\xE9dico eliminado.",this.cargarMedicos()},error:e=>{console.error("Error eliminando m\xE9dico:",e),this.mensaje="Error eliminando m\xE9dico."}})}formHorarioPorDefecto(){return{id:null,fecha:"",hora:"",disponible:!0}}verHorarios(i){this.medicoActual=i,this.vista="horarios",this.cargarHorarios()}cargarHorarios(){this.medicoActual&&(this.cargandoHorarios=!0,this.horSvc.listar(this.medicoActual.id).subscribe({next:i=>{this.horarios=i,this.cargandoHorarios=!1},error:i=>{console.error("Error cargando horarios:",i),this.mensaje="Error cargando horarios.",this.cargandoHorarios=!1}}))}nuevoHorario(){this.modoHorario="crear",this.formHorario=this.formHorarioPorDefecto()}editarHorario(i){this.modoHorario="editar";let e=i.hora.slice(0,5);this.formHorario={id:i.id,fecha:i.fecha,hora:e,disponible:i.disponible}}cancelarHorario(){this.modoHorario="crear",this.formHorario=this.formHorarioPorDefecto()}guardarHorario(){this.medicoActual&&(this.modoHorario==="crear"?this.horSvc.crear(this.medicoActual.id,{fecha:this.formHorario.fecha,hora:this.formHorario.hora,disponible:this.formHorario.disponible}).subscribe({next:()=>{this.mensaje="Horario creado.",this.cancelarHorario(),this.cargarHorarios()},error:i=>{console.error("Error creando horario:",i),this.mensaje="Error creando horario."}}):this.horSvc.actualizar(this.formHorario.id,{fecha:this.formHorario.fecha,hora:this.formHorario.hora,disponible:this.formHorario.disponible}).subscribe({next:()=>{this.mensaje="Horario actualizado.",this.cancelarHorario(),this.cargarHorarios()},error:i=>{console.error("Error actualizando horario:",i),this.mensaje="Error actualizando horario."}}))}eliminarHorario(i){confirm(`\xBFEliminar el horario ${i.fecha} ${i.hora}?`)&&this.horSvc.eliminar(i.id).subscribe({next:()=>{this.mensaje="Horario eliminado.",this.cargarHorarios()},error:e=>{console.error("Error eliminando horario:",e),this.mensaje="Error eliminando horario."}})}volverAListaMedicos(){this.vista="lista",this.medicoActual=null,this.cancelarHorario()}static \u0275fac=function(e){return new(e||o)(E(X),E(Q),E(A))};static \u0275cmp=P({type:o,selectors:[["app-panel-admin-medicos"]],decls:7,vars:4,consts:[["medForm","ngForm"],["horForm","ngForm"],[1,"container","mt-4"],[1,"text-danger","mb-4"],["class","alert alert-info",4,"ngIf"],[4,"ngIf"],[1,"alert","alert-info"],[1,"row","mb-3","g-2","align-items-center"],[1,"col-sm"],[1,"input-group"],["type","text","placeholder","Buscar m\xE9dico...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"col-auto"],["type","button",1,"btn","btn-success",3,"click"],["class","alert alert-warning",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"alert","alert-warning"],[1,"table-responsive"],[1,"table","table-striped","align-middle"],[2,"width","200px"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary","me-1",3,"click"],[1,"btn","btn-sm","btn-danger","me-1",3,"click"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"mt-3",3,"ngSubmit"],[1,"mb-3"],[1,"form-label"],["name","nombres","required","",1,"form-control",3,"ngModelChange","ngModel"],["name","correo","type","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["name","especialidad","required","",1,"form-select",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-success"],["type","button",1,"btn","btn-secondary","ms-2",3,"click"],[3,"ngValue"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"text-primary"],[1,"text-muted"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"my-4"],[1,"row","g-3",3,"ngSubmit"],[1,"col-sm-4"],["type","date","name","fecha","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","time","name","hora","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-sm-4","d-flex","align-items-end"],[1,"form-check","mb-0"],["type","checkbox","id","dispChk","name","disponible",1,"form-check-input",3,"ngModelChange","ngModel"],["for","dispChk",1,"form-check-label"],[1,"col-12"],["class","btn btn-secondary ms-2","type","button",3,"click",4,"ngIf"],[1,"table","table-sm","table-bordered","align-middle"],[1,"table-light"],[2,"width","130px"],[1,"badge",3,"ngClass"],[1,"btn","btn-sm","btn-danger",3,"click"]],template:function(e,s){e&1&&(t(0,"div",2)(1,"h2",3),a(2,"Administrar M\xE9dicos"),r(),h(3,ie,2,1,"div",4)(4,ae,13,4,"ng-container",5)(5,le,24,8,"ng-container",5)(6,be,35,12,"ng-container",5),r()),e&2&&(c(3),m("ngIf",s.mensaje),c(),m("ngIf",s.vista==="lista"),c(),m("ngIf",s.vista==="formMedico"),c(),m("ngIf",s.vista==="horarios"))},dependencies:[j,I,k,T,J,L,U,G,N,D,$,O,q,R,B,z],encapsulation:2})};export{Y as PanelAdminMedicos};
