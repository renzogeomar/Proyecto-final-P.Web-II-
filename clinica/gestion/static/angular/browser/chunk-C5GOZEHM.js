import{a as te}from"./chunk-CFYADBSK.js";import{a as ie}from"./chunk-ZJXPOUTS.js";import{a as Z,b as ee}from"./chunk-IGMEQJMD.js";import{b as $,c as B,d as L,e as U,f as G,g as R,h as J,i as K,j as Q,k as X,l as Y}from"./chunk-TKT4RXFG.js";import{Da as g,Eb as T,Fb as k,Gb as j,Hb as N,Ib as W,Jb as q,N as O,Oa as l,Pa as i,Pb as D,Qa as n,Qb as z,R as P,Ra as x,Rb as H,Sa as E,Ta as w,Ua as S,Va as u,Wa as m,X as p,Y as _,_a as A,ab as c,bb as f,cb as I,db as M,eb as F,fb as C,gb as h,hb as b,pa as s,ta as v,za as V}from"./chunk-LWXCOFDW.js";var y=class a{constructor(t,e){this.http=t;this.auth=e}baseUrl="/api/admin/citas/";headers(){let t=this.auth.obtenerToken()||"";return new D({Authorization:`Bearer ${t}`})}listar(t=""){let e=t?new z().set("q",t):void 0;return this.http.get(this.baseUrl,{headers:this.headers(),params:e})}crear(t){return this.http.post(this.baseUrl,t,{headers:this.headers()})}actualizar(t,e){return this.http.put(`${this.baseUrl}${t}/`,e,{headers:this.headers()})}eliminar(t){return this.http.delete(`${this.baseUrl}${t}/`,{headers:this.headers()})}obtener(t){return this.http.get(`${this.baseUrl}${t}/`,{headers:this.headers()})}static \u0275fac=function(e){return new(e||a)(P(H),P(Z))};static \u0275prov=O({token:a,factory:a.\u0275fac,providedIn:"root"})};function oe(a,t){if(a&1&&(i(0,"div",8),c(1),n()),a&2){let e=m();s(),f(e.mensaje)}}function ce(a,t){a&1&&(i(0,"div",19)(1,"div",20)(2,"span",21),c(3,"Cargando..."),n()(),i(4,"p",22),c(5,"Cargando citas..."),n()())}function se(a,t){a&1&&(i(0,"div",23),x(1,"i",24),i(2,"h4"),c(3,"No se encontraron citas"),n(),i(4,"p"),c(5,"Prueba con otro t\xE9rmino de b\xFAsqueda o a\xF1ade una nueva cita."),n()())}function de(a,t){a&1&&(i(0,"span",36),c(1,"Pendiente"),n())}function le(a,t){a&1&&(i(0,"span",37),c(1,"Confirmada"),n())}function me(a,t){a&1&&(i(0,"span",38),c(1,"Cancelada"),n())}function pe(a,t){if(a&1&&(i(0,"span",39),c(1),n()),a&2){let e=m().$implicit;s(),f(e.estado)}}function _e(a,t){if(a&1){let e=S();i(0,"tr")(1,"td"),c(2),n(),i(3,"td"),c(4),n(),i(5,"td"),c(6),n(),i(7,"td"),c(8),n(),i(9,"td")(10,"span",29),g(11,de,2,0,"span",30)(12,le,2,0,"span",31)(13,me,2,0,"span",32)(14,pe,2,1,"span",33),n()(),i(15,"td",27)(16,"button",34),u("click",function(){let o=p(e).$implicit,d=m(3);return _(d.editar(o))}),c(17,"Editar"),n(),i(18,"button",35),u("click",function(){let o=p(e).$implicit,d=m(3);return _(d.eliminar(o))}),c(19,"Eliminar"),n()()()}if(a&2){let e=t.$implicit;s(2),f(e.paciente_nombre),s(2),f(e.medico_nombre),s(2),f(e.especialidad_nombre),s(2),M("",e.fecha," a las ",e.hora),s(2),l("ngSwitch",e.estado),s(),l("ngSwitchCase","Pendiente"),s(),l("ngSwitchCase","Confirmada"),s(),l("ngSwitchCase","Cancelada")}}function ge(a,t){if(a&1&&(i(0,"div",25)(1,"table",26)(2,"thead")(3,"tr")(4,"th"),c(5,"Paciente"),n(),i(6,"th"),c(7,"M\xE9dico"),n(),i(8,"th"),c(9,"Especialidad"),n(),i(10,"th"),c(11,"Fecha y Hora"),n(),i(12,"th"),c(13,"Estado"),n(),i(14,"th",27),c(15,"Acciones"),n()()(),i(16,"tbody"),g(17,_e,20,9,"tr",28),n()()()),a&2){let e=m(2);s(17),l("ngForOf",e.citas)}}function ue(a,t){if(a&1){let e=S();E(0),i(1,"div",9)(2,"div",10)(3,"input",11),b("ngModelChange",function(o){p(e);let d=m();return h(d.busqueda,o)||(d.busqueda=o),_(o)}),u("keyup.enter",function(){p(e);let o=m();return _(o.buscar())}),n(),i(4,"button",12),u("click",function(){p(e);let o=m();return _(o.buscar())}),x(5,"i",13),n()(),i(6,"button",14),u("click",function(){p(e);let o=m();return _(o.nuevo())}),x(7,"i",15),c(8,"A\xF1adir Cita "),n()(),g(9,ce,6,0,"div",16)(10,se,6,0,"div",17)(11,ge,18,1,"div",18),w()}if(a&2){let e=m();s(3),C("ngModel",e.busqueda),s(6),l("ngIf",e.cargando),s(),l("ngIf",!e.cargando&&e.citas.length===0),s(),l("ngIf",!e.cargando&&e.citas.length>0)}}function fe(a,t){if(a&1&&(i(0,"option",58),c(1),n()),a&2){let e=t.$implicit;l("ngValue",e.id),s(),F(" ",e.first_name," ",e.last_name," (",e.username,") ")}}function Ce(a,t){if(a&1&&(i(0,"option",58),c(1),n()),a&2){let e=t.$implicit,r=m(2);l("ngValue",e.id),s(),M(" ",e.nombres," (",r.nombreEspecialidad(e.especialidad),") ")}}function he(a,t){if(a&1&&(i(0,"option",59),c(1),n()),a&2){let e=t.$implicit;l("value",e),s(),f(e)}}function be(a,t){if(a&1){let e=S();E(0),i(1,"h4",40),c(2),n(),i(3,"form",41,0),u("ngSubmit",function(){p(e);let o=A(4),d=m();return _(d.guardar(o))}),i(5,"div",42)(6,"label",43),c(7,"Paciente"),n(),i(8,"select",44),b("ngModelChange",function(o){p(e);let d=m();return h(d.formCita.paciente,o)||(d.formCita.paciente=o),_(o)}),i(9,"option",45),c(10,"-- Selecciona un paciente --"),n(),g(11,fe,2,4,"option",46),n()(),i(12,"div",42)(13,"label",43),c(14,"M\xE9dico"),n(),i(15,"select",47),b("ngModelChange",function(o){p(e);let d=m();return h(d.formCita.medico,o)||(d.formCita.medico=o),_(o)}),i(16,"option",45),c(17,"-- Selecciona un m\xE9dico --"),n(),g(18,Ce,2,3,"option",46),n()(),i(19,"div",48)(20,"div",49)(21,"label",43),c(22,"Fecha"),n(),i(23,"input",50),b("ngModelChange",function(o){p(e);let d=m();return h(d.formCita.fecha,o)||(d.formCita.fecha=o),_(o)}),n()(),i(24,"div",49)(25,"label",43),c(26,"Hora"),n(),i(27,"input",51),b("ngModelChange",function(o){p(e);let d=m();return h(d.formCita.hora,o)||(d.formCita.hora=o),_(o)}),n()()(),i(28,"div",42)(29,"label",43),c(30,"Estado"),n(),i(31,"select",52),b("ngModelChange",function(o){p(e);let d=m();return h(d.formCita.estado,o)||(d.formCita.estado=o),_(o)}),g(32,he,2,2,"option",53),n()(),i(33,"div",54)(34,"button",55),u("click",function(){p(e);let o=m();return _(o.cancelar())}),c(35,"Cancelar"),n(),i(36,"button",56),x(37,"i",57),c(38),n()()(),w()}if(a&2){let e=A(4),r=m();s(2),f(r.modo==="crear"?"A\xF1adir Nueva Cita":"Editar Cita"),s(6),C("ngModel",r.formCita.paciente),s(),l("ngValue",null),s(2),l("ngForOf",r.pacientes),s(4),C("ngModel",r.formCita.medico),s(),l("ngValue",null),s(2),l("ngForOf",r.medicos),s(5),C("ngModel",r.formCita.fecha),s(4),C("ngModel",r.formCita.hora),s(4),C("ngModel",r.formCita.estado),s(),l("ngForOf",r.estados),s(4),l("disabled",e.invalid),s(2),I(" ",r.modo==="crear"?"Crear Cita":"Guardar Cambios"," ")}}var ne=class a{constructor(t,e,r,o){this.svc=t;this.pacSvc=e;this.medSvc=r;this.espSvc=o}citas=[];pacientes=[];medicos=[];especialidades=[];cargando=!0;mensaje="";busqueda="";mostrandoFormulario=!1;modo="crear";formCita=this.formPorDefecto();estados=["Pendiente","Confirmada","Atendida","Cancelada"];ngOnInit(){this.cargarDataInicial()}formPorDefecto(){return{id:null,paciente:null,medico:null,fecha:"",hora:"",estado:"Pendiente"}}cargarDataInicial(){this.cargando=!0,this.pacSvc.listar().subscribe({next:t=>this.pacientes=t,error:t=>console.error("Error pacientes",t)}),this.medSvc.listar().subscribe({next:t=>this.medicos=t,error:t=>console.error("Error medicos",t)}),this.espSvc.listar().subscribe({next:t=>this.especialidades=t,error:t=>console.error("Error especialidades",t)}),this.cargarCitas()}cargarCitas(){this.svc.listar(this.busqueda).subscribe({next:t=>{this.citas=t,this.cargando=!1},error:t=>{console.error("Error cargando citas:",t),this.mensaje="Error cargando citas.",this.cargando=!1}})}buscar(){this.cargarCitas()}nuevo(){this.modo="crear",this.formCita=this.formPorDefecto(),this.mostrandoFormulario=!0}editar(t){this.modo="editar",this.formCita={id:t.id,paciente:t.paciente,medico:t.medico,fecha:t.fecha,hora:t.hora,estado:t.estado},this.mostrandoFormulario=!0}cancelar(){this.mostrandoFormulario=!1,this.formCita=this.formPorDefecto()}guardar(t){if(t.invalid)return;let e={paciente:this.formCita.paciente,medico:this.formCita.medico,fecha:this.formCita.fecha,hora:this.formCita.hora,estado:this.formCita.estado};this.modo==="crear"?this.svc.crear(e).subscribe({next:()=>{this.mensaje="Cita creada.",this.cancelar(),this.cargarCitas()},error:r=>{console.error("Error creando cita:",r),this.mensaje="Error creando cita."}}):this.svc.actualizar(this.formCita.id,e).subscribe({next:()=>{this.mensaje="Cita actualizada.",this.cancelar(),this.cargarCitas()},error:r=>{console.error("Error actualizando cita:",r),this.mensaje="Error actualizando cita."}})}eliminar(t){confirm(`\xBFEliminar la cita de ${t.paciente_username} con ${t.medico_nombre}?`)&&this.svc.eliminar(t.id).subscribe({next:()=>{this.mensaje="Cita eliminada.",this.cargarCitas()},error:e=>{console.error("Error eliminando cita:",e),this.mensaje="Error eliminando cita."}})}nombrePaciente(t){let e=this.pacientes.find(r=>r.id===t);return e?`${e.first_name} ${e.last_name}`.trim()||e.username:`#${t}`}nombreMedico(t){let e=this.medicos.find(r=>r.id===t);return e?e.nombres:`#${t}`}nombreEspecialidad(t){if(t==null)return"";let e=this.especialidades.find(r=>r.id===t);return e?e.nombre:`#${t}`}static \u0275fac=function(e){return new(e||a)(v(y),v(te),v(ie),v(ee))};static \u0275cmp=V({type:a,selectors:[["app-panel-admin-citas"]],decls:10,vars:3,consts:[["citaForm","ngForm"],[1,"container","mt-4","admin-citas-page"],[1,"page-header"],[1,"bi","bi-calendar2-heart","page-icon"],["class","alert alert-info",4,"ngIf"],[1,"card","shadow-sm"],[1,"card-body"],[4,"ngIf"],[1,"alert","alert-info"],[1,"toolbar"],[1,"input-group","search-bar"],["type","text","placeholder","Buscar por paciente, m\xE9dico...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-search"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-plus-lg","me-2"],["class","loading-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"loading-state"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"empty-state"],[1,"bi","bi-cloud-drizzle","empty-icon"],[1,"table-responsive"],[1,"table","custom-table","align-middle"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"badge",3,"ngSwitch"],["class","badge bg-warning text-dark",4,"ngSwitchCase"],["class","badge bg-success",4,"ngSwitchCase"],["class","badge bg-danger",4,"ngSwitchCase"],["class","badge bg-secondary",4,"ngSwitchDefault"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"badge","bg-warning","text-dark"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"badge","bg-secondary"],[1,"mb-4"],[3,"ngSubmit"],[1,"mb-3"],[1,"form-label"],["name","paciente","required","",1,"form-select",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["name","medico","required","",1,"form-select",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-md-6","mb-3"],["type","date","name","fecha","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","time","name","hora","required","",1,"form-control",3,"ngModelChange","ngModel"],["name","estado","required","",1,"form-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],[1,"bi","bi-check-lg","me-2"],[3,"ngValue"],[3,"value"]],template:function(e,r){e&1&&(i(0,"div",1)(1,"header",2),x(2,"i",3),i(3,"h2"),c(4,"Administrar Citas"),n()(),g(5,oe,2,1,"div",4),i(6,"div",5)(7,"div",6),g(8,ue,12,4,"ng-container",7)(9,be,39,13,"ng-container",7),n()()()),e&2&&(s(5),l("ngIf",r.mensaje),s(3),l("ngIf",!r.mostrandoFormulario),s(),l("ngIf",r.mostrandoFormulario))},dependencies:[q,T,k,j,N,W,Y,R,K,Q,$,J,B,L,X,G,U],styles:[".page-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem}.page-icon[_ngcontent-%COMP%]{font-size:2.5rem;color:#0d6efd}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:700;color:#2c3e50}.card[_ngcontent-%COMP%]{border:none;border-radius:12px}.toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem}.search-bar[_ngcontent-%COMP%]{max-width:350px}.custom-table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.custom-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#5a6a7a;border-bottom-width:2px}.custom-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .2s ease-in-out}.custom-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.custom-table[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-weight:600;padding:.4em .8em;font-size:.8rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;margin-top:2rem;border-top:1px solid #e9ecef;padding-top:1.5rem}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;color:#6c757d}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;color:#ced4da}"]})};export{ne as PanelAdminCitas};
