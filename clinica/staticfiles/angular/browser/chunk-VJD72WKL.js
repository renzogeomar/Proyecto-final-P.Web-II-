import{a as X}from"./chunk-RSWXCVJO.js";import{a as Y}from"./chunk-QIA3ECHZ.js";import{a as K,b as Q}from"./chunk-YMMBAANU.js";import{b as q,c as D,d as H,e as B,f as $,g as z,h as L,i as U,j as G,k as R,l as J}from"./chunk-D74MC6KC.js";import{Cb as T,Da as g,Db as j,Eb as O,Kb as k,Lb as W,Mb as N,N as w,Oa as m,Pa as i,Qa as n,R as E,Sa as A,Ta as y,Ua as v,Va as f,Wa as d,X as p,Y as _,_a as M,ab as o,bb as u,cb as I,db as V,eb as F,fb as h,gb as C,hb as b,pa as s,ta as x,za as P}from"./chunk-MSDOTIZ4.js";var S=class a{constructor(t,e){this.http=t;this.auth=e}baseUrl="/api/admin/citas/";headers(){let t=this.auth.obtenerToken()||"";return new k({Authorization:`Bearer ${t}`})}listar(t=""){let e=t?new W().set("q",t):void 0;return this.http.get(this.baseUrl,{headers:this.headers(),params:e})}crear(t){return this.http.post(this.baseUrl,t,{headers:this.headers()})}actualizar(t,e){return this.http.put(`${this.baseUrl}${t}/`,e,{headers:this.headers()})}eliminar(t){return this.http.delete(`${this.baseUrl}${t}/`,{headers:this.headers()})}obtener(t){return this.http.get(`${this.baseUrl}${t}/`,{headers:this.headers()})}static \u0275fac=function(e){return new(e||a)(E(N),E(K))};static \u0275prov=w({token:a,factory:a.\u0275fac,providedIn:"root"})};function ie(a,t){if(a&1&&(i(0,"div",5),o(1),n()),a&2){let e=d();s(),u(e.mensaje)}}function ne(a,t){a&1&&(i(0,"div"),o(1,"Cargando citas..."),n())}function ae(a,t){a&1&&(i(0,"div",13),o(1," No se encontraron citas. "),n())}function re(a,t){if(a&1){let e=v();i(0,"tr")(1,"td"),o(2),n(),i(3,"td"),o(4),n(),i(5,"td"),o(6),n(),i(7,"td"),o(8),n(),i(9,"td"),o(10),n(),i(11,"td"),o(12),n(),i(13,"td")(14,"button",18),f("click",function(){let r=p(e).$implicit,l=d(3);return _(l.editar(r))}),o(15,"Editar"),n(),i(16,"button",19),f("click",function(){let r=p(e).$implicit,l=d(3);return _(l.eliminar(r))}),o(17,"Eliminar"),n()()()}if(a&2){let e=t.$implicit;s(2),u(e.paciente_nombre),s(2),u(e.medico_nombre),s(2),u(e.especialidad_nombre),s(2),u(e.fecha),s(2),u(e.hora),s(2),u(e.estado)}}function oe(a,t){if(a&1&&(i(0,"div",14)(1,"table",15)(2,"thead")(3,"tr")(4,"th"),o(5,"Paciente"),n(),i(6,"th"),o(7,"M\xE9dico"),n(),i(8,"th"),o(9,"Especialidad"),n(),i(10,"th"),o(11,"Fecha"),n(),i(12,"th"),o(13,"Hora"),n(),i(14,"th"),o(15,"Estado"),n(),i(16,"th",16),o(17,"Acciones"),n()()(),i(18,"tbody"),g(19,re,18,6,"tr",17),n()()()),a&2){let e=d(2);s(19),m("ngForOf",e.citas)}}function se(a,t){if(a&1){let e=v();A(0),i(1,"div",6)(2,"div",7)(3,"input",8),b("ngModelChange",function(r){p(e);let l=d();return C(l.busqueda,r)||(l.busqueda=r),_(r)}),n(),i(4,"button",9),f("click",function(){p(e);let r=d();return _(r.buscar())}),o(5,"Buscar"),n()(),i(6,"button",10),f("click",function(){p(e);let r=d();return _(r.nuevo())}),o(7,"A\xF1adir Cita"),n()(),g(8,ne,2,0,"div",4)(9,ae,2,0,"div",11)(10,oe,20,1,"div",12),y()}if(a&2){let e=d();s(3),h("ngModel",e.busqueda),s(5),m("ngIf",e.cargando),s(),m("ngIf",!e.cargando&&e.citas.length===0),s(),m("ngIf",!e.cargando&&e.citas.length>0)}}function ce(a,t){a&1&&(i(0,"h4"),o(1,"A\xF1adir Cita"),n())}function le(a,t){a&1&&(i(0,"h4"),o(1,"Editar Cita"),n())}function me(a,t){if(a&1&&(i(0,"option",24),o(1),n()),a&2){let e=t.$implicit;m("ngValue",e.id),s(),F(" ",e.first_name," ",e.last_name," (",e.username,") ")}}function de(a,t){if(a&1&&(i(0,"option",24),o(1),n()),a&2){let e=t.$implicit,c=d(2);m("ngValue",e.id),s(),V(" ",e.nombres," (",c.nombreEspecialidad(e.especialidad),") ")}}function pe(a,t){if(a&1&&(i(0,"option",35),o(1),n()),a&2){let e=t.$implicit;m("value",e),s(),u(e)}}function _e(a,t){if(a&1){let e=v();A(0),g(1,ce,2,0,"h4",4)(2,le,2,0,"h4",4),i(3,"form",20,0),f("ngSubmit",function(){p(e);let r=M(4),l=d();return _(l.guardar(r))}),i(5,"div",21)(6,"label",22),o(7,"Paciente"),n(),i(8,"select",23),b("ngModelChange",function(r){p(e);let l=d();return C(l.formCita.paciente,r)||(l.formCita.paciente=r),_(r)}),i(9,"option",24),o(10,"-- Selecciona --"),n(),g(11,me,2,4,"option",25),n()(),i(12,"div",21)(13,"label",22),o(14,"M\xE9dico"),n(),i(15,"select",26),b("ngModelChange",function(r){p(e);let l=d();return C(l.formCita.medico,r)||(l.formCita.medico=r),_(r)}),i(16,"option",24),o(17,"-- Selecciona --"),n(),g(18,de,2,3,"option",25),n()(),i(19,"div",27)(20,"div",28)(21,"label",22),o(22,"Fecha"),n(),i(23,"input",29),b("ngModelChange",function(r){p(e);let l=d();return C(l.formCita.fecha,r)||(l.formCita.fecha=r),_(r)}),n()(),i(24,"div",28)(25,"label",22),o(26,"Hora"),n(),i(27,"input",30),b("ngModelChange",function(r){p(e);let l=d();return C(l.formCita.hora,r)||(l.formCita.hora=r),_(r)}),n()()(),i(28,"div",21)(29,"label",22),o(30,"Estado"),n(),i(31,"select",31),b("ngModelChange",function(r){p(e);let l=d();return C(l.formCita.estado,r)||(l.formCita.estado=r),_(r)}),g(32,pe,2,2,"option",32),n()(),i(33,"button",33),o(34),n(),i(35,"button",34),f("click",function(){p(e);let r=d();return _(r.cancelar())}),o(36,"Cancelar"),n()(),y()}if(a&2){let e=d();s(),m("ngIf",e.modo==="crear"),s(),m("ngIf",e.modo==="editar"),s(6),h("ngModel",e.formCita.paciente),s(),m("ngValue",null),s(2),m("ngForOf",e.pacientes),s(4),h("ngModel",e.formCita.medico),s(),m("ngValue",null),s(2),m("ngForOf",e.medicos),s(5),h("ngModel",e.formCita.fecha),s(4),h("ngModel",e.formCita.hora),s(4),h("ngModel",e.formCita.estado),s(),m("ngForOf",e.estados),s(2),I(" ",e.modo==="crear"?"Crear Cita":"Guardar Cambios"," ")}}var Z=class a{constructor(t,e,c,r){this.svc=t;this.pacSvc=e;this.medSvc=c;this.espSvc=r}citas=[];pacientes=[];medicos=[];especialidades=[];cargando=!0;mensaje="";busqueda="";mostrandoFormulario=!1;modo="crear";formCita=this.formPorDefecto();estados=["Pendiente","Confirmada","Atendida","Cancelada"];ngOnInit(){this.cargarDataInicial()}formPorDefecto(){return{id:null,paciente:null,medico:null,fecha:"",hora:"",estado:"Pendiente"}}cargarDataInicial(){this.cargando=!0,this.pacSvc.listar().subscribe({next:t=>this.pacientes=t,error:t=>console.error("Error pacientes",t)}),this.medSvc.listar().subscribe({next:t=>this.medicos=t,error:t=>console.error("Error medicos",t)}),this.espSvc.listar().subscribe({next:t=>this.especialidades=t,error:t=>console.error("Error especialidades",t)}),this.cargarCitas()}cargarCitas(){this.svc.listar(this.busqueda).subscribe({next:t=>{this.citas=t,this.cargando=!1},error:t=>{console.error("Error cargando citas:",t),this.mensaje="Error cargando citas.",this.cargando=!1}})}buscar(){this.cargarCitas()}nuevo(){this.modo="crear",this.formCita=this.formPorDefecto(),this.mostrandoFormulario=!0}editar(t){this.modo="editar",this.formCita={id:t.id,paciente:t.paciente,medico:t.medico,fecha:t.fecha,hora:t.hora,estado:t.estado},this.mostrandoFormulario=!0}cancelar(){this.mostrandoFormulario=!1,this.formCita=this.formPorDefecto()}guardar(t){if(t.invalid)return;let e={paciente:this.formCita.paciente,medico:this.formCita.medico,fecha:this.formCita.fecha,hora:this.formCita.hora,estado:this.formCita.estado};this.modo==="crear"?this.svc.crear(e).subscribe({next:()=>{this.mensaje="Cita creada.",this.cancelar(),this.cargarCitas()},error:c=>{console.error("Error creando cita:",c),this.mensaje="Error creando cita."}}):this.svc.actualizar(this.formCita.id,e).subscribe({next:()=>{this.mensaje="Cita actualizada.",this.cancelar(),this.cargarCitas()},error:c=>{console.error("Error actualizando cita:",c),this.mensaje="Error actualizando cita."}})}eliminar(t){confirm(`\xBFEliminar la cita de ${t.paciente_username} con ${t.medico_nombre}?`)&&this.svc.eliminar(t.id).subscribe({next:()=>{this.mensaje="Cita eliminada.",this.cargarCitas()},error:e=>{console.error("Error eliminando cita:",e),this.mensaje="Error eliminando cita."}})}nombrePaciente(t){let e=this.pacientes.find(c=>c.id===t);return e?`${e.first_name} ${e.last_name}`.trim()||e.username:`#${t}`}nombreMedico(t){let e=this.medicos.find(c=>c.id===t);return e?e.nombres:`#${t}`}nombreEspecialidad(t){if(t==null)return"";let e=this.especialidades.find(c=>c.id===t);return e?e.nombre:`#${t}`}static \u0275fac=function(e){return new(e||a)(x(S),x(X),x(Y),x(Q))};static \u0275cmp=P({type:a,selectors:[["app-panel-admin-citas"]],decls:6,vars:3,consts:[["citaForm","ngForm"],[1,"container","mt-4"],[1,"text-danger","mb-4"],["class","alert alert-info",4,"ngIf"],[4,"ngIf"],[1,"alert","alert-info"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"input-group","w-auto"],["type","text","placeholder","Buscar...",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"btn","btn-success",3,"click"],["class","alert alert-warning",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"alert","alert-warning"],[1,"table-responsive"],[1,"table","table-striped","align-middle"],[2,"width","130px"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary","me-1",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"mt-3",3,"ngSubmit"],[1,"mb-3"],[1,"form-label"],["name","paciente","required","",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["name","medico","required","",1,"form-select",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-md-6","mb-3"],["type","date","name","fecha","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","time","name","hora","required","",1,"form-control",3,"ngModelChange","ngModel"],["name","estado","required","",1,"form-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-success"],["type","button",1,"btn","btn-secondary","ms-2",3,"click"],[3,"value"]],template:function(e,c){e&1&&(i(0,"div",1)(1,"h2",2),o(2,"Administrar Citas"),n(),g(3,ie,2,1,"div",3)(4,se,11,4,"ng-container",4)(5,_e,37,13,"ng-container",4),n()),e&2&&(s(3),m("ngIf",c.mensaje),s(),m("ngIf",!c.mostrandoFormulario),s(),m("ngIf",c.mostrandoFormulario))},dependencies:[O,T,j,J,z,U,G,q,L,D,H,R,$,B],encapsulation:2})};export{Z as PanelAdminCitas};
